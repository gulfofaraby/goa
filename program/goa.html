<!DOCTYPE html>
<html>
<head>
  <style>body{color:white; background-color:black;} p{color:white; font-size:48px; font-type:"Courier New"; margin:.1em;}</style>
  <style> .container{position:relative; float:left; width:800px; margin:0px; padding:0px; display:flex; align-items:center; justify-content:center;} .text-block {position:absolute; background:rgb(0,0,0); background:rgba(0,0,0,0.7); color: white; padding-left:15px; padding-right:15px; margin:0px;}</style>
  <style> .container2{position:relative; float:left; height:450px; margin:0px; padding:0px; display:flex; align-items:center; justify-content:center;}</style>
  <script src="../jspsych.js"></script>
  <script src="../plugins/jspsych-animation.js"></script>
  <script src="../plugins/jspsych-html-keyboard-response.js"></script>
  <script src="../plugins/jspsych-image-keyboard-response.js"></script>
  <link rel="stylesheet" href="../css/jspsych.css"></link>
</head>
<script>
  const picPath = '../docs/img_goa/';
  var step;  
  var picsB = [];
  for (step = 0; step < 2; step++) 
    picsB.push(picPath.concat('b', step, '.jpg'));
  var picsL = [];
  for (step = 0; step < 24; step++) 
    picsL.push(picPath.concat('l', step, '.jpg'));
  var picsP = [];
  for (step = 0; step < 24; step++) 
    picsP.push(picPath.concat('p', step, '.jpg'));
  var picsS = [];
//  for (step = 0; step < 8; step++) 
//    picsS.push(picPath.concat('s', step, '.jpg'));
  var picsV = [];
  for (step = 0; step < 11; step++) 
    picsV.push(picPath.concat('v', step, '.jpg'));
  const picsA = picsB.concat(picsL, picsP, picsS, picsV);

  var block1Content = [
    {bg:'black0.jpg', text:'simply focus and relax'},
    {bg:'spiral1.gif', text:'simply focus and relax'},
    {},
    {text:'just breathe in'},
    {},
    {text:'and breathe out'},
    {},
    {text:' breathe in'},
    {},
    {text:'and breathe out'},
    {},
    {text:'breathe in'},
    {text:'and focus'},
    {},
    {text:'and breathe out'},
    {text:'and relax'},
    {},
    {text:'simply breathe'},
    {},
    {text:'and focus'},
    {},
    {text:'       as you relax       ', dur: 1000},
    {text:'       as you focus       ', dur: 333},
    {text:'       as you relax deeper', dur: 667},
    {dur: 10000},
    {text:'relax. breathe. focus.'},
    {},
    {text:'  it\'s  good  to  relax  ', dur: 800},
    {text:'        good      relax  ', dur: 300},
    {text:'      a good girl relaxes', dur: 500},
    {text:'  it\'s  good  to  relax  ', dur: 500},
    {},
    {text:'breathe. focus. relax.'},
    {},
    {text:'         it\'s  relaxing  to  focus         '},
    {text:'               relax         focus         ', dur: 150},
    {text:'  good girl,   relax   and   focus         ', dur: 400},
    {text:'  good girl    relax         focus         ', dur: 150},
    {text:'a good girl is relaxed  and  focused       ', dur: 400},
    {text:'         it\'s  relaxing  to  focus         ', dur: 600},
    {dur: 5000},
    {text:'           it\'s  good  to  focus  and  relax           ', dur: 1450},
    {text:'                 good girl focus  and  relax           ', dur: 400},
    {text:'                 good girl                             ', dur: 150},
    {text:'you want to be a good girl                             ', dur: 400},
    {text:'                                                       ', dur: 50},
    {text:'               you want to be a good girl              ', dur: 150},
    {dur: 1500},
    {text:' breathe       focus       relax  '},
    {text:'a good girl is focused and relaxed', dur: 300},
    {text:' breathe       focus       relax  ', dur: 200},
    {text:'a good girl is focused and relaxed', dur: 1800},
    {text:' breathe       focus       relax  ', dur: 200},
    {text:'a good girl is focused and relaxed', dur: 500},
    {text:'  good girl                       ', dur: 100},
    {text:'                                  ', dur: 100},
    {text:'  good girl                       ', dur: 700},
    {text:'                                  ', dur: 100},
    {},
    {text:'you want to be a good girl', dur: 600},
    {text:'                          ', dur: 100},
    {text:'you want to be a good girl', dur: 200},
    {bg: 'v3.jpg', text:'you want to be a good girl', dur: 150},
    {bg: 'p18_c.jpg', text:'you want to be a good girl', dur: 150},
    {bg: 'p21.jpg', text:'you want to be a good girl', dur: 150},
    {bg: 'l11_c.jpg', text:'you want to be a good girl', dur: 150},
    {bg:'spiral0.gif', text:'you want to be a good girl', dur: 200},
    {dur: 3000},
    {text:'you\'d like to relax much deeper', dur: 1200},
    {bg: 'p18_c.jpg', text:'you\'d like to relax much deeper', dur: 100},
    {bg: 'spiral0.gif', text:'you\'d like to relax much deeper', dur: 400},
    {dur: 3000},
    {text: 'the next exercise'},
    {text: 'will help you relax much deeper'},
    {dur: 3000},
    {text: 'breathe and watch closely'},
    {},
    {text: 'simply breathe                              '},
    {text: '               and focus                    '},
    {text: '                         and watch          '},
    {text: '                                   and relax'},
    {},
    {bg: 'black0.jpg', dur: 1000}
  ];
  
  var block1Trials = [];
  var block1BG = 'black0.jpg';
  block1Content.forEach(function(block1Cont) {
    if (block1Cont.bg != null) {
      block1BG = block1Cont.bg;
    }
    if (block1Cont.text == null && block1Cont.dur == null) {
      block1Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block1BG + '" style="width:100%;"></div>'});
    } else if (block1Cont.text == null) {
      block1Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block1BG + '" style="width:100%;"></div>', trial_duration: block1Cont.dur});
    } else if (block1Cont.dur == null) {
      block1Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block1BG + '" style="width:100%;"><div class="text-block"><p><pre>' + block1Cont.text + '</pre></p></div></div>'});
    } else {
      block1Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block1BG + '" style="width:100%;"><div class="text-block"><p><pre>' + block1Cont.text + '</pre></p></div></div>', trial_duration: block1Cont.dur});
    }
  });

  /*
  var block2Content = [
    {trial: 15, text: 'it\'s relaxing to spread your legs', frames: 4},
    {trial: 25, text: 'a good girl spreads her legs', frames: 3},
    {trial: 29, image: 'spiral0.gif', dur: 5000},
    {trial: 38, text: 'it\'s relaxing  to  spread your legs               ', frames: 3},
    {trial: 41, text: 'it feels good  to  spread your legs               ', frames: 3},
    {trial: 44, text: '       a good girl spreads her legs               ', frames: 4},
    {trial: 48, text: ' it feels good  to spread your legs               ', frames: 3},
    {trial: 55, image: 'spiral0.gif', dur: 5000},
    {trial: 75, text: '                   spread your legs               ', frames: 4},
    {trial: 83, text: '                      good girl                   ', frames: 4},
    {trial: 91, text: '                   spread your legs               ', frames: 4},
    {trial: 99, text: '                      good girl                   ', frames: 4},
    {trial: 107, text: '                   spread your legs               ', frames: 4},
    {trial: 115, text: '                      good girl                   ', frames: 4},
    {trial: 123, text: '                   spread your legs               ', frames: 4},
    {trial: 131, text: '                   spread your legs               ', frames: 4},
    {trial: 139, text: '                   spread your legs               ', frames: 4},
    {trial: 150, image: 'spiral0.gif', dur: 5000},
  ];

  var block2Trials = [];
  var block2BG = picsL[Math.floor(Math.random()*picsL.length)];
  var block2BG_mem1 = block2BG;
  var block2BG_mem2 = block2BG_mem1;
  step = 0;
  var stepText = 0;
  block2Content.forEach(function(block2Cont) {
    for (; step < block2Cont.trial; step ++) {
      block2Trials.push({stimulus: '<div class="container2"><img src="' + block2BG + '" style="width:100%;"></div>'});
      block2BG_mem2 = block2BG_mem1;
      block2BG_mem1 = block2BG;
      while (block2BG == block2BG_mem1 || block2BG == block2BG_mem2)
        block2BG = picsL[Math.floor(Math.random()*picsL.length)];
    }
    if (block2Cont.frames != undefined) {
      for (stepText = 0; stepText < block2Cont.frames; stepText++) {
        block2Trials.push({stimulus: '<div class="container2"><img src="' + block2BG + '" style="width:100%;"><div class="text-block"><p><pre>' + block2Cont.text + '</pre></p></div></div>'});
        block2BG_mem2 = block2BG_mem1;
        block2BG_mem1 = block2BG;
        while (block2BG == block2BG_mem1 || block2BG == block2BG_mem2)
          block2BG = picsL[Math.floor(Math.random()*picsL.length)];
      }  
    } else {
        block2Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block2Cont.image + '" style="width:100%;"></div>', trial_duration: block2Cont.dur});
    }
      step += stepText;
  });
  */

  var block2Content = [
    {trial: 15, text: 'it\'s relaxing to spread your legs', dur: 600},
    {trial: 25, text: 'a good girl spreads her legs', dur: 400},
    {trial: 38, text: 'it\'s relaxing  to  spread your legs               ', dur: 300},
    {trial: 45, text: 'it feels good  to  spread your legs               ', dur: 300},
    {trial: 46, text: '       a good girl spreads her legs               ', dur: 600},
    {trial: 47, text: ' it feels good  to spread your legs               ', dur: 300},
    {trial: 70, text: '                   spread your legs               ', dur: 400},
    {trial: 71, text: '                      good girl                   ', dur: 200},
    {trial: 85, text: '                   spread your legs               ', dur: 500},
    {trial: 86, text: '                      good girl                   ', dur: 400},
    {trial: 99, text: '                   spread your legs               ', dur: 600},
    {trial: 100, text: '                      good girl                   ', dur: 600}
  ];

  var block2Trials = [];
  var block2BG = picsL[Math.floor(Math.random()*picsL.length)];
  var block2BG_mem1 = block2BG;
  var block2BG_mem2 = block2BG_mem1;
  step = 0;
  block2Content.forEach(function(block2Cont) {
    for (; step < block2Cont.trial; step ++) {
      block2Trials.push({stimulus: '<div class="container2"><img src="' + block2BG + '" style="width:100%;"></div>'});
      block2BG_mem2 = block2BG_mem1;
      block2BG_mem1 = block2BG;
      while (block2BG == block2BG_mem1 || block2BG == block2BG_mem2)
        block2BG = picsL[Math.floor(Math.random()*picsL.length)];
    }
    block2Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/spiral0.gif" style="width:100%;"><div class="text-block"><p><pre>' + block2Cont.text + '</pre></p></div></div>', trial_duration: block2Cont.dur});
  });
  
/*  
  for (step = 0; step < 90; step++) {
    if (nextText.trial !== step) {
      block2Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block2BG + '" style="width:100%;"></div>'});
    } else {
      block2Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block2BG + '" style="width:100%;"><div class="text-block"><p><pre>' + nextText.text + '</pre></p></div></div>'});
      nextText = block2Content.shift();
    //  nextTrial = nextText.trial;
    }
    block2BG = picsL[Math.floor(Math.random()*picsL.length)];
  } 
 
  var block2Trials = [];
  var block2BG = picsL[Math.floor(Math.random()*picsL.length)];
  var nextText = new Object();
  nextText.trial = 
  nextText = block2Content.shift();
  //var nextTrial = nextText.trial;
  for (step = 0; step < 90; step++) {
    if (nextText.trial !== step) {
      block2Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block2BG + '" style="width:100%;"></div>'});
    } else {
      block2Trials.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + block2BG + '" style="width:100%;"><div class="text-block"><p><pre>' + nextText.text + '</pre></p></div></div>'});
      nextText = block2Content.shift();
    //  nextTrial = nextText.trial;
    }
    block2BG = picsL[Math.floor(Math.random()*picsL.length)];
  } 
  */
  
  var block1 = {
    type: 'html-keyboard-response',
    choices: jsPsych.NO_KEYS,
    trial_duration: 2000,
    timeline: block1Trials,
  };

  var block2 = {
    type: 'html-keyboard-response',
    choices: jsPsych.NO_KEYS,
    trial_duration: 167,
    timeline: block2Trials,
  };
  
  var block2_strobe = {
    type: 'animation',
    stimuli: jsPsych.randomization.sampleWithoutReplacement(picsL, 24),
    sequence_reps: 1,
    frame_time: 150,
  };
  
  var iti1 = {
    type: 'animation',
    stimuli: ['../docs/img_goa/pink0.jpg', '../docs/img_goa/s7.jpg', '../docs/img_goa/pink0.jpg', '../docs/img_goa/black0.jpg', '../docs/img_goa/black0.jpg', '../docs/img_goa/black0.jpg'],
    sequence_reps: 1,
    frame_time: 100,
  };
  
  var trial2 = {
    type: 'animation',
    stimuli: jsPsych.randomization.sampleWithoutReplacement(picsA, 30),
    sequence_reps: 1,
    frame_time: 100,
  };
  
  jsPsych.init({
    timeline: [iti1, block2],
    // timeline: [block1, block2, block2_strobe, iti1, trial2],
    on_finish: function() {
      jsPsych.data.displayData();
    }
  });
</script>

</html>
