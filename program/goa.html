<!DOCTYPE html>
<html>    
<head>
  <style>
    html{height:100%}
    body{color:white; background-color:black; font-size:18px; font-family:"Courier New"; min-height:100%; overflow:auto; display:flex; align-items:center; justify-content:center;}
    .container{position:relative; float:left; /* width:600px; */ margin:0px; padding:0px; display:flex; align-items:center; justify-content:center;}
    .text-block {position:absolute; background:rgb(0,0,0); background:rgba(0,0,0,0.7); color: white; padding-left:15px; padding-right:15px; margin:0px;}
  </style>
</head>
<body>
  <audio id="music" src="music1.mp3" loop="loop"></audio>
  <div id="target"></div>
</body>
<script>
/*
  var picSets = [
      {type: 'B', n: 4},
      {type: 'L', n: 20},
      {type: 'P', n: 24},
      {type: 'V', n: 12}
  ]  

  picSets.forEach(function(picSet) {
    var eval('pics' + picSet.type) = [];
    for (let step = 0; step < picSet.n; step++)
      eval('pics' + picSet.type).push(picSet.type.toLowerCase() + step + '.jpg');
  });
  var picsA = picsB.concat(picsL, picsP, picsV);
  var imageSet = picsA;
*/

  var picsB = [];
  for (let step = 0; step < 6; step++) 
    picsB.push('b' + step + '.jpg');
  var picsL = [];
  for (let step = 0; step < 20; step++) 
    picsL.push('l' + step + '.jpg');
  var picsP = [];
  for (let step = 0; step < 24; step++) 
    picsP.push('p' + step + '.jpg');
  var picsS = [];
//  for (let step = 0; step < 8; step++) 
//    picsS.push('s' + step + '.jpg');
  var picsV = [];
  for (let step = 0; step < 12; step++) 
    picsV.push('v' + step + '.jpg');
  var picsA = picsB.concat(picsL, picsP, picsV);
  var imageSet = picsA;
 

  var block1Content = [
    {frame: 0, imgSet: picsL},
    {frame: 13, text: 'relax', img: 'spiral0.gif'},
    {frame: 15, text: 'breathe'},
    {frame: 17, text: 'focus'},
    {frame: 19, text: 'good', dur: 263},
    {frame: 20, text: 'girl', img: 'spiral1.gif', dur: 263},
    {frame: 22, text: 'ready'},
    {frame: 24, text: 'breathe'},
    {frame: 26, text: 'open'},
    {frame: 28, text: 'good', img: 'spiral0.gif', dur:263},
    {frame: 29, text: 'girl', img: 'spiral1.gif', dur:263},
    {frame: 31, text: 'spread'},
    {frame: 33, text: 'breathe'},
    {frame: 35, text: 'stare'},
    {frame: 37, text: 'good', dur: 263},
    {frame: 38, text: 'girl', dur: 263},
    {frame: 40, text: 'calm'},
    {frame: 42, text: 'breathe'},
    {frame: 44, text: 'ready'},
    {frame: 46, text: 'good', imgSet: picsP},
    {frame: 47, text: 'girl'},
    {frame: 50, text: 'fertile'},
    {frame: 54, text: 'spread your legs', dur: 526},
    {frame: 57, text: 'rapt'},
    {frame: 61, text: 'good'},
    {frame: 62, text: 'girl'},
    {frame: 65, text: 'need'},
    {frame: 69, text: 'ready to receive', dur: 526, image: 'spiral0.gif'},
    {frame: 72, text: 'breathe'},
    {frame: 76, text: 'good'},
    {frame: 77, text: 'girl'},
    {frame: 80, text: 'fertile'},
    {frame: 84, text: 'need to breed', dur: 526, image: 'spiral0.gif'},
    {frame: 87, text: 'pleasing'},
    {frame: 91, text: 'calm mind', image: 'b2.jpg'},
    {frame: 92, text: 'fertile body', image: 'b4.jpg'},
    {frame: 87, text: 'breathe', imgSet: picsA},
    {frame: 99, text: 'perfect breeding doll', dur: 526, image: 'spiral0.gif'},
    {frame: 102, text: 'open'},
    {frame: 106, text: 'full breasts', img: 'b5.jpg'},
    {frame: 107, text: 'empty head', image: 'v6.jpg'},
    {frame: 110, text: 'want', image: 'spiral0.gif'},
    {frame: 114, text: 'happy breeding slut', dur: 526},
    {frame: 117, text: 'ripe'},
    {frame: 121, text: 'good'},
    {frame: 122, text: 'girl'},
    {frame: 125, text: 'comply'},
    {frame: 129, text: 'ready to receive', dur: 526, image: 'spiral0.gif'},
    {frame: 132, text: 'breathe'},
    {frame: 136, text: 'good'},
    {frame: 137, text: 'girl'},
    {frame: 140, text: 'fertile'},
    {frame: 144, text: 'need to breed', dur: 526, image: 'spiral0.gif'},
    {frame: 147, text: 'pleasing'},
    {frame: 151, text: 'calm mind', image: 'v11.jpg'},
    {frame: 152, text: 'fertile body', image: 'b4.jpg'},
    {frame: 157, text: 'breathe'},
    {frame: 159, text: 'perfect breeding doll', dur: 526, image: 'spiral0.gif'},
    {frame: 162, text: 'open'},
    {frame: 166, text: 'full breasts', img: 'b5.jpg'},
    {frame: 167, text: 'empty head', image: 'v6.jpg'},
    {frame: 170, text: 'want', image: 'spiral0.gif'},
    {frame: 174, text: 'happy breeding slut', dur: 526}
  /*  {frame: 7, text: 'it\'s relaxing to spread your legs', img: 'spiral1.gif'},
    {frame: 15, text: 'a good girl spreads her legs', img: 'spiral0.gif'},
    {frame: 20, text: 'it\'s relaxing  to  spread your legs'},
    {frame: 22, text: 'it feels good  to  spread your legs'},
    {frame: 27, text: 'a good girl has her legs spread', img: 'spiral0.gif'},
    {frame: 34, text: 'it\'s good  to  spread your legs', img: 'spiral0.gif'},
    {frame: 38, text: 'a good girl feels so good with her legs spread'},
    {frame: 40, text: 'so relaxing to spread your legs', img: 'spiral1.gif'},
    {frame: 50, text: 'with your legs spread, you are'},
    {frame: 50, text: 'ready'},
    {frame: 52, text: 'to'},
    {frame: 53, text: 'receive'},
    {frame: 59, text: 'focused relaxed ready to receive', dur:2000},
    {frame: 75} */
  ];
  var block1Frames = [];
  var block1BG = imageSet[Math.floor(Math.random()*imageSet.length)];
  var block1BG_mem1 = block1BG;
  var block1BG_mem2 = block1BG_mem1;

  function nextFrame() {
      block1BG_mem2 = block1BG_mem1;
      block1BG_mem1 = block1BG;
      while (block1BG == block1BG_mem1 || block1BG == block1BG_mem2)
        block1BG = imageSet[Math.floor(Math.random()*imageSet.length)];
      return block1BG;
  }

  var frameStep = 0;
  block1Content.forEach(function(block1Cont) {
    for (; frameStep < block1Cont.frame; frameStep ++) {
      block1Frames.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + nextFrame() + '" style="max-height:600px;"></div>'});
    }
    if (block1Cont.imgSet != undefined) {
      imageSet = block1Cont.imgSet;
    }
    if (block1Cont.img != undefined) {
      frameImg = block1Cont.img;
    } else {
      frameImg = nextFrame();
    }
    if (block1Cont.text != undefined) {
      block1Frames.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + frameImg + '" style="max-height:600px;"><div class="text-block"><p><pre>' + block1Cont.text + '</pre></p></div></div>', duration: block1Cont.dur});
    } else {
      block1Frames.push({stimulus: '<div class="container"><img src="../docs/img_goa/' + frameImg + '" style="max-height:600px;"></div>', duration: block1Cont.dur});
    }
    frameStep++;
  });

  var block1 = {frames: block1Frames, dur: 526};
  var blocks = [block1];
  var blockCur;
  var duration;
  var frameCur;
  var frameNow = 0;
  var defaultDur_passed;
  var target = document.getElementById("target")

  function runFramesInner(frames, defaultDuration) {
    if (frames[0] != undefined) {
      frameCur = frames.shift();
      target.innerHTML = frameCur.stimulus;
      if (frameCur.duration == undefined) {
        duration = defaultDuration;
      } else {
        duration = frameCur.duration;
      }
      if (frameNow != 45) {
        frameNow ++;
        setTimeout(runFramesInner, duration, frames, defaultDuration);
      } else {
        frameNow ++;
        setTimeout(runFramesInner, duration, frames, defaultDuration / 2);
      }
    } else {
      runFrames();
    }
  }

  function runFrames() {
    if (blocks[0] != undefined) {
      blockCur = blocks.shift();
      runFramesInner(blockCur.frames, blockCur.dur);
    } else {
      document.body.innerHTML = 'end of program';
    }
  }

  var playMusic = document.getElementById("music").play();
  function start() {
    if (playMusic !== undefined) {
      playMusic.then(_ => {
      })
      .catch(error => {
      });
    }
  runFrames();
}

setTimeout(start, 2000);

</script>
</html>